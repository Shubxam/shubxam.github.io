<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Shubham Soni">
<meta name="dcterms.date" content="2023-03-29">
<meta name="description" content="This post serves as an Introduction to Capital Asset Pricing Model in Finance and How to implement it using Python.">

<title>Shubham Soni - Introduction to CAPM using Python</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Shubham Soni</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html">
 <span class="menu-text">writings</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects.html">
 <span class="menu-text">Projects</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Introduction to CAPM using Python</h1>
                  <div>
        <div class="description">
          This post serves as an Introduction to Capital Asset Pricing Model in Finance and How to implement it using Python.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Finance</div>
                <div class="quarto-category">Python</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Shubham Soni </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">March 29, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction-to-capm" id="toc-introduction-to-capm" class="nav-link active" data-scroll-target="#introduction-to-capm">Introduction to CAPM</a>
  <ul class="collapse">
  <li><a href="#basic-theory" id="toc-basic-theory" class="nav-link" data-scroll-target="#basic-theory">Basic Theory</a></li>
  <li><a href="#usecases" id="toc-usecases" class="nav-link" data-scroll-target="#usecases">Usecases</a></li>
  <li><a href="#how-is-capm-useful-for-investors" id="toc-how-is-capm-useful-for-investors" class="nav-link" data-scroll-target="#how-is-capm-useful-for-investors">How is CAPM useful for Investors</a></li>
  <li><a href="#shortfalls-limitations" id="toc-shortfalls-limitations" class="nav-link" data-scroll-target="#shortfalls-limitations">Shortfalls (limitations)</a></li>
  <li><a href="#usual-doubts-related-to-capm" id="toc-usual-doubts-related-to-capm" class="nav-link" data-scroll-target="#usual-doubts-related-to-capm">Usual Doubts related to CAPM</a></li>
  </ul></li>
  <li><a href="#practical-example-in-indian-context-with-python-code-with-code-outputs" id="toc-practical-example-in-indian-context-with-python-code-with-code-outputs" class="nav-link" data-scroll-target="#practical-example-in-indian-context-with-python-code-with-code-outputs">Practical Example (In Indian Context) with Python Code with code outputs</a>
  <ul class="collapse">
  <li><a href="#getting-data" id="toc-getting-data" class="nav-link" data-scroll-target="#getting-data">Getting Data</a></li>
  <li><a href="#eda-of-historic-data" id="toc-eda-of-historic-data" class="nav-link" data-scroll-target="#eda-of-historic-data">EDA of historic Data</a></li>
  <li><a href="#capm-model" id="toc-capm-model" class="nav-link" data-scroll-target="#capm-model">CAPM Model</a></li>
  <li><a href="#conslusion" id="toc-conslusion" class="nav-link" data-scroll-target="#conslusion">Conslusion</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="introduction-to-capm" class="level2">
<h2 class="anchored" data-anchor-id="introduction-to-capm">Introduction to CAPM</h2>
<ul>
<li>The Capital Asset Pricing Model is a mathematical model used to estimate the expected return of an investment based on its risk level relative to the market.</li>
<li>Goal is to Check if stock is fairly valued taking into account its risk and time value of money.</li>
<li>He identified two types of risk
<ol type="1">
<li>systematic: Also called market risk. It is influenced by factors such as interest rates, inflation, recessions and geopolitical events like war. all assets are impacted in similar ways.</li>
<li>unsystematic: these are risks that are unique to each asset.</li>
</ol></li>
<li>The capital asset pricing model concentrates on measuring systemic risk and its impact on the value of an asset.</li>
<li>CAPM helps factor in systemic risks to estimate the fair value of an asset and understand the relationship between risk and expected returns.</li>
<li>Shows relationship between systematic risk and expected returns.</li>
<li>Based on beta, risk free rate, market risk premium.</li>
<li>Widely used for pricing risky securities because its simple and allows easy comparisons.</li>
<li>Used in conjuction with MPT to understand portfolio risk and expected returns.</li>
<li>The CAPM was developed in the early 1960s by Financial Economist William Sharpe who built his work on the ideas put forth by Harry Markowitz.</li>
</ul>
<section id="basic-theory" class="level3">
<h3 class="anchored" data-anchor-id="basic-theory">Basic Theory</h3>
<ul>
<li>Key Terms for CAPM
<ul>
<li>Expected Return: It is a well-grounded estimate of the returns an investor can expect over the life of an investment.</li>
<li>Risk Free Rate: The rate of return an investor would expect from an asset that bears no risk.
<ul>
<li>In india it is taken as the 10 year government bond yield since they are backed by the full faith and credit of the Indian Government.</li>
<li>As of Dec 23, 2022 it is 7.33%</li>
</ul></li>
<li>Beta: It quantifies the riskiness (volatility) of a stock compared with the market.
<ul>
<li>=1</li>
<li>&lt;1</li>
<li>&gt;1</li>
</ul></li>
<li>Market Risk Premium: Historical returns generated by a comparable market.</li>
</ul></li>
<li>Briefly put, the CAPM model generates the expected returns of assets given the risk of those assets. This is known as <strong>risk-adjusted</strong> expected return.</li>
<li>The formula is as follows:</li>
</ul>
<p><span class="math display">\[ER_i = Rf + \beta \times [ER_m - Rf]\]</span></p>
<p>where <span class="math inline">\(ER_i\)</span> = Expected Return of Asset</p>
<p><span class="math inline">\(Rf\)</span> = Risk Free rate is the rate of return of an asset with zero risk. In india it is taken as the 10 year government bond yield. 7.33%</p>
<p><span class="math inline">\(\beta\)</span> = Beta Value of Stock. It quantifies the riskiness (volatility) of a stock compared with the market.</p>
<p><span class="math inline">\(ER_m\)</span> = market premium. Returns generated by market for given tenure.</p>
</section>
<section id="usecases" class="level3">
<h3 class="anchored" data-anchor-id="usecases">Usecases</h3>
<ul>
<li>Importance of beta of companies for investors</li>
<li>The CAPM plays a key role in financial modeling and asset valuation</li>
<li>While valuing a stock, an investor uses WACC to find NPV of future cash flows. CAPM is used to calculate cost of equity in calculation of WACC.</li>
<li>CAPM formula is still widely used because it is simple and allows for easy comparisons of investment alternatives.</li>
<li>Used as a tool combined with other methods of evaluating securities, it can play an integral role in helping investment professionals make informed investment decisions.</li>
<li>it is used in conjunction with modern portfolio theory (MPT) to understand portfolio risk and expected returns.</li>
</ul>
</section>
<section id="how-is-capm-useful-for-investors" class="level3">
<h3 class="anchored" data-anchor-id="how-is-capm-useful-for-investors">How is CAPM useful for Investors</h3>
</section>
<section id="shortfalls-limitations" class="level3">
<h3 class="anchored" data-anchor-id="shortfalls-limitations">Shortfalls (limitations)</h3>
<ul>
<li>Assumes that risk free rate remains constant. Over an analyst’s chosen investment time horizon, the risk-free rate can fluctuate</li>
</ul>
</section>
<section id="usual-doubts-related-to-capm" class="level3">
<h3 class="anchored" data-anchor-id="usual-doubts-related-to-capm">Usual Doubts related to CAPM</h3>
<ul>
<li><p>How it differentiates from other similar methods</p>
<ul>
<li>Arbitrage Pricing Theory a multi-factor model that looks at multiple factors, grouped into macroeconomic or company-specific factors.</li>
<li>FAMA French 3 Factor Model expands on CAPM by adding company-size risk and value risk factors to the market risk factors.</li>
</ul></li>
<li><p>Which one is better?</p></li>
<li><p>Disclaimer (Not a tip to buy selected stocks)</p></li>
</ul>
</section>
</section>
<section id="practical-example-in-indian-context-with-python-code-with-code-outputs" class="level2">
<h2 class="anchored" data-anchor-id="practical-example-in-indian-context-with-python-code-with-code-outputs">Practical Example (In Indian Context) with Python Code with code outputs</h2>
<section id="getting-data" class="level3">
<h3 class="anchored" data-anchor-id="getting-data">Getting Data</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#importing required libraries</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> yfinance <span class="im">as</span> yf</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co">#getting historic stock data from yfinance</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>stocks_list <span class="op">=</span> [<span class="st">'BHARTIARTL.NS'</span>, <span class="st">'ITC.NS'</span>, <span class="st">'HDFCBANK.NS'</span>,<span class="st">'^NSEI'</span>]</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> yf.download(stocks_list, period<span class="op">=</span><span class="st">'5y'</span>)[<span class="st">'Adj Close'</span>]</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>data.columns <span class="op">=</span> [<span class="st">'BHARTIARTL'</span>,<span class="st">'HDFCBANK'</span>, <span class="st">'ITC'</span>,<span class="st">'NIFTY_50'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="eda-of-historic-data" class="level3">
<h3 class="anchored" data-anchor-id="eda-of-historic-data">EDA of historic Data</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="normalize-stock-prices-so-easy-to-compare" class="level4">
<h4 class="anchored" data-anchor-id="normalize-stock-prices-so-easy-to-compare">Normalize stock prices (so easy to compare)</h4>
<ul>
<li>Visualise all historic prices (normalized)</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Normalizing Stock Prices</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> normalize_prices(df):</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; df_ <span class="op">=</span> df.copy()</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; <span class="cf">for</span> stock <span class="kw">in</span> df_.columns:</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; &nbsp; df_[stock] <span class="op">=</span> df_[stock]<span class="op">/</span>df_[stock][<span class="dv">0</span>]</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; <span class="cf">return</span> df_</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>norm_df <span class="op">=</span> normalize_prices(data)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the normalized stock prices </span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.line(title <span class="op">=</span> <span class="st">"Normalized stock prices"</span>)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> stock <span class="kw">in</span> norm_df.columns:</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; fig.add_scatter(x <span class="op">=</span> norm_df.index.values, y <span class="op">=</span> norm_df[stock], name <span class="op">=</span> stock)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="CAPM/newplot.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Chart-1</figcaption><p></p>
</figure>
</div>
</section>
<section id="calculating-daily-returns" class="level4">
<h4 class="anchored" data-anchor-id="calculating-daily-returns">Calculating Daily Returns (%)</h4>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating Daily % change in stock prices</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>daily_returns <span class="op">=</span> norm_df.pct_change()</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>daily_returns.iloc[<span class="dv">0</span>,:] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplot of daily returns (in %)</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>daily_returns.boxplot(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>), grid<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Daily returns of the stocks"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="CAPM/plot-2.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">plot-2</figcaption><p></p>
</figure>
</div>
</section>
<section id="interpreting-the-results" class="level4">
<h4 class="anchored" data-anchor-id="interpreting-the-results">Interpreting the results</h4>
</section>
</section>
<section id="capm-model" class="level3">
<h3 class="anchored" data-anchor-id="capm-model">CAPM Model</h3>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initializing empty dictionaries to save results</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>beta,alpha <span class="op">=</span> <span class="bu">dict</span>(), <span class="bu">dict</span>()</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a nice subplot</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">3</span>, dpi<span class="op">=</span><span class="dv">150</span>, figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">8</span>))</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>axes <span class="op">=</span> axes.flatten()</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop on every stock daily return</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, stock <span class="kw">in</span> <span class="bu">enumerate</span>(daily_returns.columns.values[:<span class="op">-</span><span class="dv">1</span>]):</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; <span class="co"># scatter plot between stocks and the NSE</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; daily_returns.plot(kind <span class="op">=</span> <span class="st">"scatter"</span>, x <span class="op">=</span> <span class="st">"NIFTY_50"</span>, y <span class="op">=</span> stock, ax<span class="op">=</span>axes[idx])</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; <span class="co"># Fit a line (regression using polyfit of degree 1)</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; b_, a_ <span class="op">=</span> np.polyfit(daily_returns[<span class="st">"NIFTY_50"</span>] ,daily_returns[stock], <span class="dv">1</span>)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; regression_line <span class="op">=</span> b_ <span class="op">*</span> daily_returns[<span class="st">"NIFTY_50"</span>] <span class="op">+</span> a_</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; axes[idx].plot(daily_returns[<span class="st">"NIFTY_50"</span>], regression_line, <span class="st">"-"</span>, color <span class="op">=</span> <span class="st">"r"</span>)</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; <span class="co"># save the regression coeeficient for the current stock</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; beta[stock] <span class="op">=</span> b_</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; alpha[stock] <span class="op">=</span> a_</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">"Beta estimation: regression between NIFTY_50 and individual stock daily performance"</span>, size<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="CAPM/plot-3.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">plot-3</figcaption><p></p>
</figure>
</div>
<p>The plot generated by the code is a scatterplot with a linear regression line superimposed on top of it. The scatterplot shows the relationship between the daily returns of the NIFTY_50 index and the daily returns of an individual stock. The regression line shows the overall trend in this relationship.</p>
<p>By looking at the slope of the regression line, you can determine the beta of the individual stock. Beta is a measure of a stock’s volatility in relation to the overall market. A beta of 1 means that the stock’s price moves in line with the market, while a beta less than 1 means that it is less volatile than the market, and a beta greater than 1 means that it is more volatile.</p>
<p>You can also determine the alpha of the individual stock from the intercept of the regression line. Alpha is a measure of the stock’s performance relative to the market. A positive alpha indicates that the stock has outperformed the market, while a negative alpha indicates that it has underperformed the market.</p>
<p>You can use the beta and alpha values to compare the relative risk and return of different stocks, and to make informed investment decisions.</p>
<section id="calculating-beta" class="level4">
<h4 class="anchored" data-anchor-id="calculating-beta">Calculating Beta</h4>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>keys <span class="op">=</span> <span class="bu">list</span>(beta.keys())</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>beta_3 <span class="op">=</span> <span class="bu">dict</span>()</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> keys:</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; beta_3[k] <span class="op">=</span> [daily_returns[[k,<span class="st">'NIFTY_50'</span>]].cov()<span class="op">/</span>daily_returns[<span class="st">'NIFTY_50'</span>].var()][<span class="dv">0</span>].iloc[<span class="dv">0</span>,<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Explaining beta in terms of Regression between market and stock</li>
<li>Visualize the regression line #### calculate expected return of stock prices with actual historic returns</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the expected return dictionary</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>ER <span class="op">=</span> <span class="bu">dict</span>()</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>rf <span class="op">=</span> <span class="fl">0.0733</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>trading_days <span class="op">=</span> <span class="dv">250</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate the expected return of the market using the daily returns</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>rm <span class="op">=</span> daily_returns[<span class="st">"NIFTY_50"</span>].mean() <span class="op">*</span> trading_days</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> keys:</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; <span class="co"># Calculate return for every security using CAPM</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; ER[k] <span class="op">=</span> rf <span class="op">+</span> beta[k] <span class="op">*</span> (rm<span class="op">-</span>rf)</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> keys:</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; <span class="bu">print</span>(<span class="st">"Expected return based on CAPM model for </span><span class="sc">{}</span><span class="st"> is </span><span class="sc">{}</span><span class="st">%"</span>.<span class="bu">format</span>(k, <span class="bu">round</span>(ER[k]<span class="op">*</span><span class="dv">100</span>, <span class="dv">2</span>)))</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating historic returns</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> keys:</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; <span class="bu">print</span>(<span class="st">'Return based on historical data for </span><span class="sc">{}</span><span class="st"> is </span><span class="sc">{}</span><span class="st">%'</span>.<span class="bu">format</span>(k, <span class="bu">round</span>(daily_returns[k].mean() <span class="op">*</span> <span class="dv">100</span> <span class="op">*</span> trading_days, <span class="dv">2</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="CAPM/returns-1.png" class="img-fluid" alt="returns-1"> <img src="CAPM/returns-2.png" class="img-fluid" alt="returns-2"></p>
</section>
</section>
<section id="conslusion" class="level3">
<h3 class="anchored" data-anchor-id="conslusion">Conslusion</h3>
<ul>
<li>The CAPM uses the principles of modern portfolio theory to determine if a security is fairly valued.</li>
<li>It relies on assumptions about investor behaviors, risk and return distributions, and market fundamentals that don’t match reality.</li>
<li>However, the underlying concepts of CAPM and the associated efficient frontier can help investors understand the relationship between expected risk and reward as they strive to make better decisions about adding securities to a portfolio.</li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>